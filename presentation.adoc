= Comment Your &*☠# Code
:backend: revealjs
:revealjs_center: true
:revealjs_theme: nipa-night
:revealjs_controls: false
:revealjs_history: true
:revealjs_progress: false
:revealjs_transition: slide
:revealjs_backgroundTransition: fade
:revealjs_parallaxBackgroundImage: images/12-months.png
:revealjs_parallaxBackgroundSize: 4608px 3456px

++++
<div class="event">
	<div class="participant">
		<img src="images/logo-nipa.png" class="logo">
		<div class="name">
			<p>Nicolai Parlog</p>
			<p><a href="http://codefx.org">codefx.org</a>
				/ <a href="https://twitter.com/nipafx" title="Nicolai on Twitter">@nipafx</a></p>
		</div>
	</div>
	<div class="participant">
		<img src="images/logo-devoxx.png" class="logo">
		<div class="name">
			<p><a href="http://devoxx.pl/">Devoxx PL</a></p>
			<p><a href="https://twitter.com/devoxxpl" title="Devoxx PL on Twitter">@devoxxpl</a></p>
		</div>
	</div>
</div>
++++

++++
<link rel="stylesheet" href="highlight.js/9.2.0.monokai-sublime.css">
<script src="highlight.js/9.2.0.min.js"></script>
<script>
	hljs.initHighlightingOnLoad();
	hljs.configure({tabReplace: '    '})
</script>
++++

// Just adding a footer does not work because reveal.js puts it into the slides
// and we couldn't get it out via CSS. So we move it via JavaScript.
++++
<footer>
	<div class="participant">
		<img src="images/logo-nipa.png" class="logo">
		<div class="name"><p>
			Nicolai Parlog
			/ <a href="http://codefx.org">codefx.org</a>
			/ <a href="https://twitter.com/nipafx" title="Nicolai on Twitter">@nipafx</a>
		</p></div>
	</div>
	<div class="participant">
		<img src="images/logo-devoxx.png" class="logo">
		<div class="name"><p>
			<a href="http://devoxx.pl/">Devoxx PL</a>
				/ <a href="https://twitter.com/devoxxpl" title="Devoxx PL on Twitter">@devoxxpl</a>
		</p></div>
	</div>
</footer>
<script>
	document.addEventListener('DOMContentLoaded', function () {
		document.body.appendChild(document.querySelector('footer'));
	})
</script>
++++

[data-background="images/all_code_and_no_comments.png"]
[data-state="empty"]
== !


=== The Axiom

> Comments are always failures.

(Some guy with a book.)

He's wrong!

> *Comment Your &x☠# Code*
>
> 10:20 - 11:10 +
> (right after this one) +
> Room 3


=== Self Documenting Code

I don't care about your code!

I want to know what happens when I use it!

* pre- & postconditions
* what return value can I expect?
* thread-safety
* (im)mutability


[NOTE.speaker]
--
* good names, small methods, SOLID, ... don't help here
* observed behavior != contract
* how many interface implementations am I supposed to check?
* what if I have to implement an interface?
* You're code is not a special snowflake - it's the all singing all dancing crap of the world.
* I am in a hurry and have to get shit done.
--


=== Tests

I care even less about your tests!

How do you test this?

* "for all" propositions
* thread-safety
* (im)mutability

[NOTE.speaker]
--
* do you have tests for interfaces?
* test coverage better be > 90%.
--


=== Tests

Ever heard *RTFT*? +
(Read The &*☠# Tests) +


No?

What was I thinking about?


=== Comments Age

That's like saying +
"Car's crash".

So? Do we get rid of them?

[NOTE.speaker]
--
* crashes are caused by negligence
* are often punishable by law
* do not harm the overall benefit
--


=== Comments Age

What about names?

* do they age?
* do you update them?

Yes?!

Then update the comments, too!


[data-background="images/comment-your-fucking-code.jpg"]
[data-state="empty"]
=== !


== Looking Closer...

* actuality
* locality
* alternatives


=== Actuality

* some comments need to be very up-to-date
* others can be slightly or even totally outdated

This influences costs:

* maintenance
* confusion


=== Locality

How far can a comment be away +
from what it describes?

* some must basically be on the same line +
to make any sense at all
* others might span several concepts +
so they can be some classes away

It is hard to update far-away comments!


=== Alternatives

There are plenty of alternatives to comments.

But not all work for everything.

* clean code
* tests, demos
* version control
* issue tracker
* wiki



== What does it do?

```java
public int activeUserCountSince(Date date) {
	int activeUserCount = 0;
	// loop through the users
	for (User user : users)
		// check whether user logged in
		if (user.loggedInSince(date))
			// increase activeUserCount
			activeUserCount++;
	return activeUserCount;
}
```


=== Narrations

Usually inline comments.

* explain what the code does
* speak on a very technical level


=== Analysis

Actuality::
* very high
* need to be absolutely up to date!
Location::
* right in the narrated line(s)
Alternatives::
* good names
* transparent design
* well-known patterns


=== Costs

* *composition*: medium
* *maintenance*: high
* *confusion*: high risk
* *obstruction*: yes, can't be hidden


=== Benefits

* *explain what happens*: yes
* *keep abstractions intact*: no
* *top down over bottom up*: no
* *documenting intent*: a little


=== Verdict

> Narrations suck!

&nbsp;

With one exception:

* arcane language features are used
* there is no alternative
* there is no way to improve readability



== What Does It Promise?

++++
<div style="height: 550px;">
<div class="listingblock fragment current-display"><div class="content"><pre class="highlight"><code class="java language-java hljs">public interface Map&lt;K, V&gt; {
	/**
	 * ...............................
	 * ................................
	 * ....................................
	 * ....................................
	 *
	 * @return .......................
	 *         ....................
	 */
	int size();
}</code></pre></div></div>
<div class="listingblock fragment current-display"><div class="content"><pre class="highlight"><code class="java language-java hljs">public interface Map&lt;K, V&gt; {
	/**
	 * Returns the number of key-value
	 * mappings in this map. ..........
	 * ....................................
	 * ....................................
	 *
	 * @return the number of key-value
	 *         mappings in this map
	 */
	int size();
}</code></pre></div></div>
<div class="listingblock fragment current-display"><div class="content"><pre class="highlight"><code class="java language-java hljs">public interface Map&lt;K, V&gt; {
	/**
	 * Returns the number of key-value
	 * mappings in this map. If the map
	 * contains more than Integer.MAX_VALUE
	 * elements, returns Integer.MAX_VALUE.
	 *
	 * @return the number of key-value
	 *         mappings in this map
	 */
	int size();
}</code></pre></div></div>
</div>
++++


=== Contract Comments

(or just _Contracts_)

Usually JavaDoc on classes and methods.

They define

* the code's central abstraction
* pre- and postconditions
* quirks

[NOTE.speaker]
--
* highlight "define" (not "describe")
* they make a promise
--


=== Analysis

Actuality::
* high
Location::
* right in the class or method
Alternatives::
* good names (limited)
* tests (limited)


=== Costs

* *composition*: high
* *maintenance*: considerable
* *confusion*: high risk
* *obstruction*:
** can be hidden
** and viewed on demand


=== Benefits

* *explain what happens*: yes
* *keep abstractions intact*: yes
* *top down over bottom up*: to a degree
* *documenting intent*: no


=== Verdict

> It's complicated.

&nbsp;

* costs are high if code changes often
* benefits are high if code is read often

⇝ The more stable & reused the code, +
the better the outcome!

[NOTE.speaker]
--
* "resused" often implies "stable" by necessity
* good documentation improves discoverability and adoption
--



== How does it work?

++++
<div style="height: 550px;">
<div class="listingblock fragment current-display"><div class="content"><pre class="highlight"><code class="java language-java hljs">/**
 * When keys are Comparable, this class may
 * use comparison order among keys to help
 * break ties.
 */
public class HashMap&lt;K, V&gt; { }</code></pre></div></div>
<div class="listingblock fragment current-display"><div class="content"><pre class="highlight"><code class="java language-java hljs">/**
 * When keys are Comparable, this class may
 * use comparison order among keys to help
 * break ties.
 */
public class HashMap&lt;K, V&gt; {
	/* This map usually acts as a binned
	 * (bucketed) hash table, but when bins
	 * get too large, they are transformed
	 * into bins of TreeNodes, each
	 * structured similarly to those in
     * java.util.TreeMap. */
}</code></pre></div></div>
</div>
++++

[NOTE.speaker]
--
* another example: a class explaining that a factory is required
--


=== Technical Context

Often non-Javadoc blocks +
at the beginning of a class/method.

(Check out
http://blog.codefx.org/java/new-javadoc-tags/[`@apiNote` and `@implNote`].)

* clarify what code is _for_
* when to use it and when not

(This is *not* a contract!)

[NOTE.speaker]
--
* can even give examples
* contracts make a promise, context comments explain why it was made
--


=== Analysis

Actuality::
* not that important
Location::
* not that important
Alternatives::
* demos
* existing code (limited)


=== Costs

* *composition*: moderate
* *maintenance*: not so much
* *confusion*: possible
* *obstruction*:
** can be hidden
** and viewed on demand


=== Benefits

* *explain what happens*: somewhat
* *keep abstractions intact*: a little
* *top down over bottom up*: to a degree
* *documenting intent*: yes


=== Verdict

> A clear winner!

&nbsp;

* costs are moderate
* benefits are considerable

[NOTE.speaker]
--
* avoid confusion with contracts
--



== OMG, why?!

++++
<div style="height: 550px;">
<div class="listingblock fragment current-display"><div class="content"><pre class="highlight"><code class="java language-java hljs">public Color randomFavoriteColor() {
	while (true)
		Color favorite = randomColor();
		if (isNotWhiteish(favorite))
			return favorite;
}</code></pre></div></div>
<div class="listingblock fragment current-display"><div class="content"><pre class="highlight"><code class="java language-java hljs">public Color randomFavoriteColor() {
	while (true)
		Color favorite = randomColor();
		// In China white is often seen
		// as a color of mourning and
		// some Chinese users did not
		// like it. We hence disallow
		// whitish colors as favorites.
		// For details see issue #1534.
		if (isNotWhitish(favorite))
			return favorite;
}</code></pre></div></div>
</div>
++++

[NOTE.speaker]
--

--


=== Historical Context

* clarifies why (oh why!) +
code looks the way it does
* can document paths not taken


=== Analysis

Actuality::
* negligible
Location::
* not that important
Alternatives::
* commit messages
* issues, wikis


=== Costs

* *composition*: moderate
* *maintenance*: negligible
* *confusion*: low
* *obstruction*: yes


=== Benefits

* *explain what happens*: somewhat
* *keep abstractions intact*: no
* *top down over bottom up*: no
* *documenting intent*: yes


=== Verdict

> Even better!

&nbsp;

* costs are negligible
* benefits are considerable

These are great breadcrumbs +
when tracking down bugs!



== Where Does This Leave Us?

Let's move away from

> All comments are failures.

Instead

> Comments are a tool to facilitate understanding.
> We should use it wisely!


=== Clean Comments

This is my proposal:

* avoid _narrations_ whenever possible
* always have a paragraph that explains +
a class's central abstraction
* add _contracts_ to reused APIs
* provide as much _context_ as possible

It must be obvious +
into which category a comment belongs!


=== Clean Comments

But the details depend on many factors:

* team:
** size
** technical backgrounds
* code base:
** size
** heterogeneity
** ownership


=== Clean Comments

So:

* get the team together and +
speak *freely* about comments
* go through the code base and +
*discuss* concrete examples
* settle on a *shared approach* and +
include it in your team's style guide
* use pair programming or code reviews +
to *adapt and enforce*



[data-background="images/question-mark.jpg"]
== Questions?

+++<h3>Find Me</h3>+++

http://codefx.org[codefx.org] / https://twitter.com/nipafx[@nipafx] / https://google.com/+NicolaiParlog[+NicolaiParlog]

+++<h3>Me</h3>+++

you can http://blog.codefx.org/hire-nicolai-parlog/[hire me]

since 2016: Java channel editor at http://sitepoint.com[SitePoint]

2014-2016: Java developer at http://www.disy.net/en/welcome.html[Disy]

2011-2014: Java developer at http://www.isi.fraunhofer.de/isi-en/index.php[Fraunhofer ISI]

until 2010: CS and Math at http://www.tu-dortmund.de[TU Dortmund]


== Image Credits

* question-mark:
http://milosevicmilos.com/[Milos Milosevic]
(https://creativecommons.org/licenses/by/2.0/[CC-BY 2.0])
